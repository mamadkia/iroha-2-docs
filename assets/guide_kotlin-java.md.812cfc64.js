import{_ as s,c as n,o as a,d as o}from"./app.5cbb4beb.js";const h='{"title":"Kotlin/Java guide","description":"","frontmatter":{},"headers":[{"level":2,"title":"1. Iroha 2 Client Setup","slug":"_1-iroha-2-client-setup"},{"level":2,"title":"2. Configuring Iroha 2","slug":"_2-configuring-iroha-2"},{"level":2,"title":"3. Registering a Domain","slug":"_3-registering-a-domain"},{"level":2,"title":"4. Registering an Account","slug":"_4-registering-an-account"},{"level":2,"title":"5. Registering and minting assets","slug":"_5-registering-and-minting-assets"},{"level":2,"title":"6. Visualizing outputs","slug":"_6-visualizing-outputs"}],"relativePath":"guide/kotlin-java.md","lastUpdated":1646223014000}',l={},e=o(`<h1 id="kotlin-java-guide" tabindex="-1">Kotlin/Java guide <a class="header-anchor" href="#kotlin-java-guide" aria-hidden="true">#</a></h1><h2 id="_1-iroha-2-client-setup" tabindex="-1">1. Iroha 2 Client Setup <a class="header-anchor" href="#_1-iroha-2-client-setup" aria-hidden="true">#</a></h2><p>In this part we shall cover the main things to look out for if you want to use Iroha 2 in your Kotlin application. Instead of providing the complete basics, we shall assume knowledge of the most widely used concepts, explain the unusual, and provide some instructions for creating your own Iroha 2-compatible client.</p><p>We assume that you know how to create a new package, and have basic understanding of the fundamental kotlin code. Specifically, we shall assume that you know how to build and deploy your program on the target platforms. The Iroha 2 JVM-compatible SDKs are as much a work-in-progress as the rest of this guide, and significantly more so than the Rust library.</p><p>Without further ado, here\u2019s an example <code>build.gradle</code> file.</p><div class="language-kotlin"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#24292F;">allprojects {</span></span>
<span class="line"><span style="color:#24292F;">    repositories {</span></span>
<span class="line"><span style="color:#24292F;">        ...</span></span>
<span class="line"><span style="color:#24292F;">        maven { url &#39;https</span><span style="color:#CF222E;">:</span><span style="color:#6E7781;">//jitpack.io&#39; }</span></span>
<span class="line"><span style="color:#24292F;">    }</span></span>
<span class="line"><span style="color:#24292F;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">dependencies {</span></span>
<span class="line"><span style="color:#24292F;">        api &#39;com.github.hyperledger.iroha</span><span style="color:#CF222E;">-</span><span style="color:#24292F;">java</span><span style="color:#CF222E;">:</span><span style="color:#24292F;">client</span><span style="color:#CF222E;">:</span><span style="color:#24292F;">iroha2</span><span style="color:#CF222E;">-</span><span style="color:#24292F;">dev</span><span style="color:#CF222E;">-</span><span style="color:#953800;">SNAPSHOT</span><span style="color:#24292F;">&#39;</span></span>
<span class="line"><span style="color:#24292F;">        api &#39;com.github.hyperledger.iroha</span><span style="color:#CF222E;">-</span><span style="color:#24292F;">java</span><span style="color:#CF222E;">:</span><span style="color:#24292F;">model</span><span style="color:#CF222E;">:</span><span style="color:#24292F;">iroha2</span><span style="color:#CF222E;">-</span><span style="color:#24292F;">dev</span><span style="color:#CF222E;">-</span><span style="color:#953800;">SNAPSHOT</span><span style="color:#24292F;">&#39;</span></span>
<span class="line"><span style="color:#24292F;">        api &#39;com.github.hyperledger.iroha</span><span style="color:#CF222E;">-</span><span style="color:#24292F;">java</span><span style="color:#CF222E;">:</span><span style="color:#24292F;">block</span><span style="color:#CF222E;">:</span><span style="color:#24292F;">iroha2</span><span style="color:#CF222E;">-</span><span style="color:#24292F;">dev</span><span style="color:#CF222E;">-</span><span style="color:#953800;">SNAPSHOT</span><span style="color:#24292F;">&#39;</span></span>
<span class="line"><span style="color:#24292F;">        api &#39;com.github.hyperledger.iroha</span><span style="color:#CF222E;">-</span><span style="color:#24292F;">java</span><span style="color:#CF222E;">:</span><span style="color:#24292F;">testcontainers</span><span style="color:#CF222E;">:</span><span style="color:#24292F;">iroha2</span><span style="color:#CF222E;">-</span><span style="color:#24292F;">dev</span><span style="color:#CF222E;">-</span><span style="color:#953800;">SNAPSHOT</span><span style="color:#24292F;">&#39;</span></span>
<span class="line"><span style="color:#24292F;">}</span></span>
<span class="line"></span></code></pre></div><p>This will give you the latest development release of Iroha 2.</p><h2 id="_2-configuring-iroha-2" tabindex="-1">2. Configuring Iroha 2 <a class="header-anchor" href="#_2-configuring-iroha-2" aria-hidden="true">#</a></h2><p>At present the Kotlin SDK doesn\u2019t have any classes to interact with the configuration. Instead, you are provided with a ready-made <code>Iroha2Client</code> that reads the configuration from the environment variables and/or the resident <code>config.json</code> in the working directory.</p><p>If you are so inclined, you can have a look at the testcontainers module, and see how the <code>Iroha2Config</code> is implemented.</p><div class="language-kotlin"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">package</span><span style="color:#24292F;"> </span><span style="color:#953800;">jp.co.soramitsu.iroha2.testcontainers</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.Genesis</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.generated.core.genesis.GenesisTransaction</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.generated.core.genesis.RawGenesisBlock</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> org.slf4j.LoggerFactory.getLogger</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> org.testcontainers.containers.Network</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> org.testcontainers.containers.Network.newNetwork</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> org.testcontainers.containers.output.OutputFrame</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> org.testcontainers.containers.output.Slf4jLogConsumer</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> java.util.function.Consumer</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CF222E;">class</span><span style="color:#24292F;"> </span><span style="color:#953800;">IrohaConfig</span><span style="color:#24292F;">(</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">var</span><span style="color:#24292F;"> networkToJoin</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">Network</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> newNetwork(),</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">var</span><span style="color:#24292F;"> logConsumer</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">Consumer</span><span style="color:#CF222E;">&lt;</span><span style="color:#953800;">OutputFrame</span><span style="color:#CF222E;">&gt;</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">Slf4jLogConsumer</span><span style="color:#24292F;">(getLogger(IrohaContainer::</span><span style="color:#0550AE;">class</span><span style="color:#24292F;">.java)),</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">var</span><span style="color:#24292F;"> genesis</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">Genesis</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">Genesis</span><span style="color:#24292F;">(</span><span style="color:#953800;">RawGenesisBlock</span><span style="color:#24292F;">(</span><span style="color:#0550AE;">listOf</span><span style="color:#24292F;">(</span><span style="color:#953800;">GenesisTransaction</span><span style="color:#24292F;">(</span><span style="color:#0550AE;">listOf</span><span style="color:#24292F;">())))),</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">var</span><span style="color:#24292F;"> shouldCloseNetwork</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">Boolean</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">true</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">var</span><span style="color:#24292F;"> maxLogLevel</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">MaxLogLevel</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">MaxLogLevel</span><span style="color:#24292F;">.</span><span style="color:#953800;">INFO</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">var</span><span style="color:#24292F;"> imageTag</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">String</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">IrohaContainer</span><span style="color:#24292F;">.</span><span style="color:#953800;">DEFAULT_IMAGE_TAG</span></span>
<span class="line"><span style="color:#24292F;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CF222E;">enum</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">class</span><span style="color:#24292F;"> </span><span style="color:#953800;">MaxLogLevel</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#953800;">ERROR</span><span style="color:#24292F;">, </span><span style="color:#953800;">WARN</span><span style="color:#24292F;">, </span><span style="color:#953800;">INFO</span><span style="color:#24292F;">, </span><span style="color:#953800;">DEBUG</span><span style="color:#24292F;">, </span><span style="color:#953800;">TRACE</span></span>
<span class="line"><span style="color:#24292F;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="_3-registering-a-domain" tabindex="-1">3. Registering a Domain <a class="header-anchor" href="#_3-registering-a-domain" aria-hidden="true">#</a></h2><p>Registering a domain is one of the easier operations. The usual boiler-plate code, that often only serves to instantiate a client from an on-disk configuration file is unnecessary. Instead, one has to deal with a few imports:</p><div class="language-kotlin"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> org.junit.jupiter.api.extension.ExtendWith</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> org.junit.jupiter.api.Test</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> org.junit.jupiter.api.Assertions</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.engine.IrohaRunnerExtension</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.Iroha2Client</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.engine.WithIroha</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> kotlinx.coroutines.runBlocking</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> kotlin.test.assertEquals</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> java.util.concurrent.TimeUnit</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.generated.datamodel.account.Id </span><span style="color:#CF222E;">as</span><span style="color:#24292F;"> </span><span style="color:#953800;">AccountId</span></span>
<span class="line"></span></code></pre></div><p>We shall write this example in the form of a test class, hence the presence of test-related packages. Note the presence of <code>coroutines.runBlocking</code>. Iroha makes extensive use of asynchronous programming (in Rust terminology), hence blocking is not necessarily the only mode of interaction with the Iroha 2 code.</p><p>We have started by creating a mutable lazy-initialised client. This client is passed an instance of a domain registration box, which we get as a result of evaluating <code>registerDomain(domainName)</code>. Then the client is sent a transaction which consists of that one instruction. And that\u2019s it.</p><div class="language-kotlin"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">@ExtendWith</span><span style="color:#24292F;">(</span><span style="color:#953800;">IrohaRunnerExtension</span><span style="color:#24292F;">::</span><span style="color:#0550AE;">class</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#CF222E;">class</span><span style="color:#24292F;"> </span><span style="color:#953800;">Test</span><span style="color:#24292F;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">    lateinit </span><span style="color:#CF222E;">var</span><span style="color:#24292F;"> client</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">Iroha2Client</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">@Test</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">@WithIroha</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">fun</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">\`register domain instruction committed\`</span><span style="color:#24292F;">()</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">Unit</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> runBlocking {</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">val</span><span style="color:#24292F;"> domainName </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&quot;looking_glass&quot;</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">val</span><span style="color:#24292F;"> aliceAccountId </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">AccountId</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&quot;alice&quot;</span><span style="color:#24292F;">, </span><span style="color:#0A3069;">&quot;wonderland&quot;</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">        client.sendTransaction {</span></span>
<span class="line"><span style="color:#24292F;">            accountId </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">AccountId</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&quot;alice&quot;</span><span style="color:#24292F;">, </span><span style="color:#0A3069;">&quot;wonderland&quot;</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">            registerDomain(domainName)</span></span>
<span class="line"><span style="color:#24292F;">            buildSigned(</span><span style="color:#953800;">ALICE_KEYPAIR</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">        }.</span><span style="color:#0550AE;">also</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">            </span><span style="color:#953800;">Assertions</span><span style="color:#24292F;">.assertDoesNotThrow {</span></span>
<span class="line"><span style="color:#24292F;">                it.get(</span><span style="color:#0550AE;">10</span><span style="color:#24292F;">, </span><span style="color:#953800;">TimeUnit</span><span style="color:#24292F;">.</span><span style="color:#953800;">SECONDS</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">            }</span></span>
<span class="line"><span style="color:#24292F;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#953800;">QueryBuilder</span><span style="color:#24292F;">.findDomainByName(domainName)</span></span>
<span class="line"><span style="color:#24292F;">            .account(aliceAccountId)</span></span>
<span class="line"><span style="color:#24292F;">            .buildSigned(</span><span style="color:#953800;">ALICE_KEYPAIR</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">            .</span><span style="color:#0550AE;">let</span><span style="color:#24292F;"> { query </span><span style="color:#CF222E;">-&gt;</span><span style="color:#24292F;"> client.sendQuery(query) }</span></span>
<span class="line"><span style="color:#24292F;">            .</span><span style="color:#0550AE;">also</span><span style="color:#24292F;"> { result </span><span style="color:#CF222E;">-&gt;</span><span style="color:#24292F;"> assertEquals(result.name, domainName) }</span></span>
<span class="line"><span style="color:#24292F;">    }</span></span>
<span class="line"><span style="color:#24292F;">}</span></span>
<span class="line"></span></code></pre></div><p>Well almost. You may have noticed that we had to do this on behalf of <code>aliceAccountId</code>. This is because any transaction on the Iroha 2 blockchain has to be done by an account. This is a special account that must already exist on the blockchain. You can ensure that point by reading through <code>genesis.json</code> and seeing that <strong><em>alice</em></strong> indeed has an account, with a public key. Furthermore, the account&#39;s public key must be included in the configuration. If either of these two is missing, you will not be able to register an account, and will be greeted by an exception of an appropriate type.</p><h2 id="_4-registering-an-account" tabindex="-1">4. Registering an Account <a class="header-anchor" href="#_4-registering-an-account" aria-hidden="true">#</a></h2><p>Registering a domain is more involved than the aforementioned functions. Previously, we only had to worry about submitting a single instruction, with a single string-based registration box (In Rust terminology, the heap-allocated reference types are all called boxes).</p><p>When registering a domain, there are a few more variables: The account can only be registered to an existing domain. Also, an account typically has to have a key pair. So if e.g. <em>alice@wonderland</em> was registering an account for <em>late_bunny@looking_glass</em> she should provide his public key.</p><p>It is tempting to generate both the private and public keys at this time, but it isn&#39;t the brightest idea. Remember, that <em>the late_bunny</em> trusts <em>you, alice@wonderland,</em> to create an account for them in the domain <em>looking_glass, <strong>but doesn&#39;t want you to have access to that account after creation</strong>.</em> If you gave <em>late_bunny</em> a key that you generated yourself, how would they know if you don&#39;t have a copy of their private key? Instead, the best way is to <strong>ask</strong> <em>late_bunny</em> to generate a new key-pair, and give you the public half of it.</p><p>Similarly to the previous example, we provide the instructions in the form of a test:</p><div class="language-kotlin"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> org.junit.jupiter.api.extension.ExtendWith</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> org.junit.jupiter.api.Test</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> org.junit.jupiter.api.Assertions</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.engine.IrohaRunnerExtension</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.Iroha2Client</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.generateKeyPair</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.engine.WithIroha</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> kotlinx.coroutines.runBlocking</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> kotlin.test.assertEquals</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> java.util.concurrent.TimeUnit</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.generated.datamodel.account.Id </span><span style="color:#CF222E;">as</span><span style="color:#24292F;"> </span><span style="color:#953800;">AccountId</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CF222E;">@ExtendWith</span><span style="color:#24292F;">(</span><span style="color:#953800;">IrohaRunnerExtension</span><span style="color:#24292F;">::</span><span style="color:#0550AE;">class</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#CF222E;">class</span><span style="color:#24292F;"> </span><span style="color:#953800;">Test</span><span style="color:#24292F;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">    lateinit </span><span style="color:#CF222E;">var</span><span style="color:#24292F;"> client</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">Iroha2Client</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">@Test</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">@WithIroha</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">fun</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">\`register account instruction committed\`</span><span style="color:#24292F;">()</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">Unit</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> runBlocking {</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">val</span><span style="color:#24292F;"> aliceAccountId </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">AccountId</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&quot;alice&quot;</span><span style="color:#24292F;">, </span><span style="color:#0A3069;">&quot;wonderland&quot;</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">val</span><span style="color:#24292F;"> newAccountId </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">AccountId</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&quot;late_bunny&quot;</span><span style="color:#24292F;">, </span><span style="color:#0A3069;">&quot;looking_glass&quot;</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">val</span><span style="color:#24292F;"> keyPair </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> generateKeyPair()</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">val</span><span style="color:#24292F;"> signatories </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">listOf</span><span style="color:#24292F;">(keyPair.</span><span style="color:#CF222E;">public</span><span style="color:#24292F;">.toIrohaPublicKey())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">        client.sendTransaction {</span></span>
<span class="line"><span style="color:#24292F;">            accountId </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> aliceAccountId</span></span>
<span class="line"><span style="color:#24292F;">            registerAccount(newAccountId, signatories)</span></span>
<span class="line"><span style="color:#24292F;">            buildSigned(</span><span style="color:#953800;">ALICE_KEYPAIR</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">        }.</span><span style="color:#0550AE;">also</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">            </span><span style="color:#953800;">Assertions</span><span style="color:#24292F;">.assertDoesNotThrow {</span></span>
<span class="line"><span style="color:#24292F;">                it.get(</span><span style="color:#0550AE;">10</span><span style="color:#24292F;">, </span><span style="color:#953800;">TimeUnit</span><span style="color:#24292F;">.</span><span style="color:#953800;">SECONDS</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">            }</span></span>
<span class="line"><span style="color:#24292F;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#953800;">QueryBuilder</span><span style="color:#24292F;">.findAccountById(newAccountId)</span></span>
<span class="line"><span style="color:#24292F;">            .account(aliceAccountId)</span></span>
<span class="line"><span style="color:#24292F;">            .buildSigned(</span><span style="color:#953800;">ALICE_KEYPAIR</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">            .</span><span style="color:#0550AE;">let</span><span style="color:#24292F;"> { query </span><span style="color:#CF222E;">-&gt;</span><span style="color:#24292F;"> client.sendQuery(query) }</span></span>
<span class="line"><span style="color:#24292F;">            .</span><span style="color:#0550AE;">also</span><span style="color:#24292F;"> { account </span><span style="color:#CF222E;">-&gt;</span><span style="color:#24292F;"> assertEquals(account.id, newAccountId) }</span></span>
<span class="line"><span style="color:#24292F;">    }</span></span>
<span class="line"><span style="color:#24292F;">}</span></span>
<span class="line"></span></code></pre></div><p>As you can see, for <em>illustrative purposes</em>, we have generated a new key-pair. We converted that key-pair into an Iroha-compatible format using <code>toIrohaPublicKey</code>, and added the public key to the instruction to register the account. Again, it\u2019s important to note that we are using <em>alice@wonderland</em> as a proxy to interact with the blockchain, hence her credentials also appear in the transaction.</p><h2 id="_5-registering-and-minting-assets" tabindex="-1">5. Registering and minting assets <a class="header-anchor" href="#_5-registering-and-minting-assets" aria-hidden="true">#</a></h2><p>Now we must talk a little about assets. Iroha has been built with few underlying assumptions about what the assets need to be. The assets can be fungible (every \xA31 is exactly the same as every other \xA31), or non-fungible (a \xA31 bill signed by the Queen of Hearts is not the same as a \xA31 bill signed by the King of Spades), mintable (you can make more of them) and non-mintable (you can only specify their initial quantity in the genesis block). Additionally, the assets have different underlying value types.</p><p>Specifically, we have <code>AssetValueType.Quantity</code> which is effectively an unsigned 32-bit integer, a <code>BigQuantity</code> which is an unsigned 128 bit integer; which is enough to trade all possible IPV6 addresses, and quite possibly individual grains of sand on the surface of the earth and <code>Fixed</code>, which is a positive (though signed) 64-bit fixed-precision number with nine significant digits after the decimal point. It doesn&#39;t quite use binary-coded decimal for performance reasons. All three types can be registered as either <strong>mintable</strong> or <strong>non-mintable</strong>.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>The non-mintable assets are a relatively recent addition to Iroha 2, thus registering and minting such assets is not presently possible through the Kotlin SDK.</p></div><div class="language-kotlin"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> org.junit.jupiter.api.extension.ExtendWith</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> org.junit.jupiter.api.Test</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> org.junit.jupiter.api.Assertions</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.engine.IrohaRunnerExtension</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.Iroha2Client</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.engine.WithIroha</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> kotlinx.coroutines.runBlocking</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> kotlin.test.assertEquals</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> java.util.concurrent.TimeUnit</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.generated.datamodel.asset.AssetValue</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.generated.datamodel.asset.AssetValueType</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.generated.datamodel.account.Id </span><span style="color:#CF222E;">as</span><span style="color:#24292F;"> </span><span style="color:#953800;">AccountId</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.generated.datamodel.asset.Id </span><span style="color:#CF222E;">as</span><span style="color:#24292F;"> </span><span style="color:#953800;">AssetId</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.generated.datamodel.asset.DefinitionId</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CF222E;">@ExtendWith</span><span style="color:#24292F;">(</span><span style="color:#953800;">IrohaRunnerExtension</span><span style="color:#24292F;">::</span><span style="color:#0550AE;">class</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#CF222E;">class</span><span style="color:#24292F;"> </span><span style="color:#953800;">Test</span><span style="color:#24292F;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">    lateinit </span><span style="color:#CF222E;">var</span><span style="color:#24292F;"> client</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">Iroha2Client</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">@Test</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">@WithIroha</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">fun</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">\`mint asset instruction committed\`</span><span style="color:#24292F;">()</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">Unit</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> runBlocking {</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">val</span><span style="color:#24292F;"> aliceAccountId </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">AccountId</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&quot;alice&quot;</span><span style="color:#24292F;">, </span><span style="color:#0A3069;">&quot;wonderland&quot;</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">val</span><span style="color:#24292F;"> definitionId </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">DefinitionId</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&quot;time&quot;</span><span style="color:#24292F;">, </span><span style="color:#0A3069;">&quot;looking_glass&quot;</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">val</span><span style="color:#24292F;"> assetId </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">AssetId</span><span style="color:#24292F;">(definitionId, aliceAccountId)</span></span>
<span class="line"><span style="color:#24292F;">				</span><span style="color:#CF222E;">val</span><span style="color:#24292F;"> newAccountId </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">AccountId</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&quot;late_bunny&quot;</span><span style="color:#24292F;">, </span><span style="color:#0A3069;">&quot;looking_glass&quot;</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">val</span><span style="color:#24292F;"> keyPair </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> generateKeyPair()</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">val</span><span style="color:#24292F;"> signatories </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">listOf</span><span style="color:#24292F;">(keyPair.</span><span style="color:#CF222E;">public</span><span style="color:#24292F;">.toIrohaPublicKey())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">        client.sendTransaction {</span></span>
<span class="line"><span style="color:#24292F;">            account(aliceAccountId)</span></span>
<span class="line"><span style="color:#24292F;">            registerAsset(definitionId, </span><span style="color:#953800;">AssetValueType</span><span style="color:#24292F;">.</span><span style="color:#953800;">Fixed</span><span style="color:#24292F;">())</span></span>
<span class="line"><span style="color:#24292F;">            buildSigned(</span><span style="color:#953800;">ALICE_KEYPAIR</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">        }.</span><span style="color:#0550AE;">also</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">            </span><span style="color:#953800;">Assertions</span><span style="color:#24292F;">.assertDoesNotThrow {</span></span>
<span class="line"><span style="color:#24292F;">                it.get(</span><span style="color:#0550AE;">10</span><span style="color:#24292F;">, </span><span style="color:#953800;">TimeUnit</span><span style="color:#24292F;">.</span><span style="color:#953800;">SECONDS</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">            }</span></span>
<span class="line"><span style="color:#24292F;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">        client.sendTransaction {</span></span>
<span class="line"><span style="color:#24292F;">            account(aliceAccountId)</span></span>
<span class="line"><span style="color:#24292F;">            mintAsset(assetId, </span><span style="color:#0550AE;">5</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">            buildSigned(</span><span style="color:#953800;">ALICE_KEYPAIR</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">        }.</span><span style="color:#0550AE;">also</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">            </span><span style="color:#953800;">Assertions</span><span style="color:#24292F;">.assertDoesNotThrow {</span></span>
<span class="line"><span style="color:#24292F;">                it.get(</span><span style="color:#0550AE;">10</span><span style="color:#24292F;">, </span><span style="color:#953800;">TimeUnit</span><span style="color:#24292F;">.</span><span style="color:#953800;">SECONDS</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">            }</span></span>
<span class="line"><span style="color:#24292F;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#953800;">QueryBuilder</span><span style="color:#24292F;">.findAccountById(aliceAccountId)</span></span>
<span class="line"><span style="color:#24292F;">            .account(aliceAccountId)</span></span>
<span class="line"><span style="color:#24292F;">            .buildSigned(</span><span style="color:#953800;">ALICE_KEYPAIR</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">            .</span><span style="color:#0550AE;">let</span><span style="color:#24292F;"> { query </span><span style="color:#CF222E;">-&gt;</span><span style="color:#24292F;"> client.sendQuery(query) }</span></span>
<span class="line"><span style="color:#24292F;">            .</span><span style="color:#0550AE;">also</span><span style="color:#24292F;"> { result </span><span style="color:#CF222E;">-&gt;</span></span>
<span class="line"><span style="color:#24292F;">                assertEquals(</span><span style="color:#0550AE;">5</span><span style="color:#24292F;">, (result.assets[assetId]?.value </span><span style="color:#CF222E;">as?</span><span style="color:#24292F;"> </span><span style="color:#953800;">AssetValue</span><span style="color:#24292F;">.</span><span style="color:#953800;">Quantity</span><span style="color:#24292F;">)?.u32)</span></span>
<span class="line"><span style="color:#24292F;">            }</span></span>
<span class="line"><span style="color:#24292F;">    }</span></span>
<span class="line"></span></code></pre></div><p>Note that our original intention was to register an asset named <em>time#looking_glass</em> that was not mintable. Due to a technical limitation we cannot prevent that asset from being minted. However, we can ensure that the late bunny is always late, by noting that <em>alice@wonderland</em> can mint time, but only to her account initially.</p><p>If she tried to mint an asset that was registered using a different client, which was not mintable, this attempt would have been rejected, <em>and alice alongside her long-eared, perpetually stressed friend would have no way of making more time</em>.</p><h2 id="_6-visualizing-outputs" tabindex="-1">6. Visualizing outputs <a class="header-anchor" href="#_6-visualizing-outputs" aria-hidden="true">#</a></h2><p>Finally, we should talk about visualising data. The Rust API is currently the most complete in terms of available queries and instructions. After all, this is the language in which Iroha 2 was built. Kotlin, by contrast supports only some features. Fortunately these features are not used/covered in the Rust tutorial either, so as to keep the walkthrough short and to-the-point.</p><p>There are two possible event filters: <code>PipelineEventFilter</code> and <code>DataEventFilter</code>, we shall focus on the former. This filter sieves events pertaining to the process of submitting a transaction, executing a transaction and committing it to a block.</p><div class="language-kotlin"><pre class="shiki shiki-light" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.generated.datamodel.events.EventFilter.Pipeline</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.generated.datamodel.events.pipeline.EventFilter</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.generated.datamodel.events.pipeline.EntityType.Transaction</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> jp.co.soramitsu.iroha2.generated.crypto.hash.Hash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CF222E;">val</span><span style="color:#24292F;"> hash</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">ByteArray</span></span>
<span class="line"><span style="color:#CF222E;">val</span><span style="color:#24292F;"> eventFilter </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">Pipeline</span><span style="color:#24292F;">(</span><span style="color:#953800;">EventFilter</span><span style="color:#24292F;">(</span><span style="color:#953800;">Transaction</span><span style="color:#24292F;">(), </span><span style="color:#953800;">Hash</span><span style="color:#24292F;">(hash)))</span></span>
<span class="line"></span></code></pre></div><p>What this short code snippet does is the following: It creates an event pipeline filter that checks if a transaction with the specified hash was submitted/rejected. This can then be used to see if the transaction we submitted was processed correctly and provide feedback to the end-user.</p>`,37),p=[e];function t(r,c,i,y,F,u){return a(),n("div",null,p)}var g=s(l,[["render",t]]);export{h as __pageData,g as default};
